# 作業ログ

## 2025-12-05 13:18:10 - ローマ字読み上げモード機能追加

### 実装内容

#### 1. 新規ファイル作成
- `src/RomajiConverter.h`: ローマ字変換クラスのヘッダファイル
- `src/RomajiConverter.cpp`: ローマ字変換ロジックの実装
  - 状態管理（初期状態、子音待機状態、n待機状態）
  - 子音/母音判定
  - ローマ字からひらがなへのマッピング
  - モード切替機能

#### 2. 既存ファイルの拡張
- `src/DisplayDataGenerator.h`: ローマ字モード用の関数を追加
  - `convert_hiragana_to_DisplayData()`: ひらがなからDisplayDataへの変換
  - `create_mode_display_data()`: モード表示用のDisplayData生成
- `src/DisplayDataGenerator.cpp`: 上記関数の実装を追加
- `src/main.cpp`: ローマ字モード対応
  - Ctrl+Mキー検出処理の追加
  - モード切替処理の実装
  - ローマ字モード時のキー入力処理の統合

#### 3. 実装した機能
- **モード切替**: Ctrl+Mでアルファベットモード ↔ ローマ字モードを切り替え
- **ローマ字入力処理**:
  - 初期状態: 母音は即読み上げ、子音は待機、'n'は特殊処理
  - 子音待機状態: 母音入力でローマ字読み上げ、別の子音は最後の子音を新規入力として扱う
  - n待機状態: 母音入力で「な/に/ぬ/ね/の」を読み上げ、子音入力で「ん」+子音を新規入力として扱う
- **ローマ字マッピング**: か行〜ぱ行までの基本ローマ字に対応

#### 4. 技術的な実装詳細
- HIDキーボードレポートの解析（modifierキー、キーコード）
- 状態機械（Finite State Machine）による入力状態管理
- ローマ字からひらがなへのマッピングテーブル

### 注意事項
- ローマ字モード用の音声ファイル（ひらがな.wav）がSDカードに必要
- 無効なローマ字組み合わせ（yi, ye, wi, we, wu等）は空文字列を返し、読み上げなし

### 次のステップ
- 実際のハードウェアでの動作確認
- 音声ファイルの準備
- 必要に応じてタイムアウト処理の追加

## 2025-12-05 13:25:03 - ローマ字モード表示サイズ調整

### 修正内容
- `src/DisplayDataGenerator.cpp`の`convert_hiragana_to_DisplayData()`関数を修正
  - フォントサイズ: 15 → 7（約半分に縮小）
  - Y座標: -20 → 50（画面からはみ出ないように中央より少し下に調整）
  - X座標: 90（変更なし、中央寄り）

### 修正理由
- 実機テストでローマ字モードの文字が大きすぎて画面からはみ出ていたため
- 特に縦方向にはみ出していたため、フォントサイズとY座標を調整

